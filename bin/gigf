#!/usr/bin/env node

/**
 * Module dependencies.
 */

const prompts = require('prompts');
const { execSync } = require('child_process');

const REPOSITORY_SSH = 'git@github.com:giginc/frontend-templates.git'

const cmd = cmd => {
  try { execSync(cmd) } catch(err) {}
}

(async function() {
  const state = {};

  const step1 = [
    {
      type: 'select',
      name: 'currentDir',
      message: 'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦å‡ºåŠ›ã—ã¾ã™ã‹ï¼Ÿ',
      choices: [
        { title: 'ã¯ã„', value: true },
        { title: 'ã„ã„ãˆ', value: false },
      ]
    }
  ];

  const step2 = [
    {
      type: 'text',
      name: 'name',
      message: 'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
    }
  ];

  const step3 = [
    {
      type: 'select',
      name: 'template',
      message: 'åˆ©ç”¨ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„',
      choices: [
        { title: 'Simple', value: null },
        { title: 'Pug', value: 'template/pug' },
        { title: 'EJS', value: 'template/ejs' }
      ]
    }
  ];

  // Step1
  Object.assign(state, await prompts(step1));

  // Step2
  if (state.currentDir) {
    Object.assign(state, await prompts(step2));
  }

  // Step3
  Object.assign(state, await prompts(step3));

  console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™...');

  if (state.template) {
    cmd(`git clone -b ${state.template} ${REPOSITORY_SSH}`);
  } else {
    cmd(`git clone ${REPOSITORY_SSH}`);
  }

  console.log('`npm install`ã‚’å®Ÿè¡Œã—ã¾ã™...');

  if (state.currentDir) {
    cmd(`mv frontend-templates ${state.name} && rm -rf ${state.name}/.git && cd ${state.name} && npm i`);
  } else {
    cmd(`mv frontend-templates/* . && rm -rf frontend-templates .git && npm i`);
  }

  console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æº–å‚™ãŒã§ãã¾ã—ãŸğŸ‰ `npm run dev`ã§é–‹ç™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼');
})();
